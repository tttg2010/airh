<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Key æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 2rem;
      background: #f5f5f7;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      margin-bottom: 1.5rem;
      color: #1d1d1f;
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 1.5rem;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #86868b;
    }
    input, textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #d2d2d7;
      border-radius: 12px;
      font-size: 1rem;
      font-family: monospace;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    button {
      background: #0071e3;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover {
      background: #0077ed;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }
    .error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }
    .info {
      background: #e3f2fd;
      color: #1565c0;
      border: 1px solid #bbdefb;
    }
    .hint {
      font-size: 0.85rem;
      color: #86868b;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>ğŸ”‘ RunningHub API Key æµ‹è¯•å·¥å…·</h1>
  
  <div class="card">
    <div class="form-group">
      <label>API Key (32ä½)</label>
      <input type="text" id="apiKey" placeholder="ç²˜è´´æ‚¨çš„32ä½API Key">
      <div class="hint" id="apiKeyHint">è¾“å…¥çš„å­—ç¬¦æ•°: 0/32</div>
    </div>
    
    <div class="form-group">
      <button onclick="testApiKey()" id="testBtn">æµ‹è¯• API Key</button>
    </div>
    
    <div id="result"></div>
  </div>

  <div class="card">
    <h2>API Key è·å–æ­¥éª¤</h2>
    <div style="margin-top: 1rem; line-height: 1.8; color: #1d1d1f;">
      1. è®¿é—® <a href="https://www.runninghub.cn" target="_blank">RunningHub å®˜ç½‘</a> å¹¶ç™»å½•<br>
      2. ç¡®ä¿è´¦æˆ·å·²å……å€¼ï¼ˆä½¿ç”¨APIéœ€è¦ä½™é¢ï¼‰<br>
      3. åœ¨ä¸ªäººä¸­å¿ƒ/è®¾ç½®ä¸­è·å– API Key<br>
      4. ç¡®ä¿ä½¿ç”¨çš„æ˜¯ä¼ä¸šçº§å…±äº« API Key<br>
      5. API Key åº”è¯¥æ˜¯ 32 ä½å­—æ¯æ•°å­—ç»„åˆ
    </div>
  </div>

    <div class="card">
      <h2>å¸¸è§é”™è¯¯è¯´æ˜</h2>
      <div style="margin-top: 1rem; line-height: 1.8; color: #1d1d1f;">
        <strong>TOKEN_INVALID (412)</strong>: API Key æ— æ•ˆæˆ–å·²è¿‡æœŸ<br>
        <strong>field 'prompt' length 2 is less than 5</strong>: æç¤ºè¯å¤ªçŸ­ï¼ˆè‡³å°‘5ä¸ªå­—ç¬¦ï¼‰<br>
        <strong>INSUFFICIENT_BALANCE</strong>: è´¦æˆ·ä½™é¢ä¸è¶³<br>
        <strong>NETWORK_ERROR</strong>: ç½‘ç»œè¿æ¥å¤±è´¥<br>
        <strong>CORS_ERROR</strong>: æµè§ˆå™¨è·¨åŸŸé™åˆ¶ï¼ˆéœ€è¦ä½¿ç”¨ä»£ç†ï¼‰
      </div>
    </div>

  <script>
    const apiKeyInput = document.getElementById('apiKey');
    const apiKeyHint = document.getElementById('apiKeyHint');
    const resultDiv = document.getElementById('result');
    const testBtn = document.getElementById('testBtn');

    // ç›‘å¬è¾“å…¥ï¼Œæ˜¾ç¤ºå­—ç¬¦æ•°
    apiKeyInput.addEventListener('input', () => {
      const len = apiKeyInput.value.length;
      apiKeyHint.textContent = `è¾“å…¥çš„å­—ç¬¦æ•°: ${len}/32`;
      
      if (len === 32) {
        apiKeyHint.style.color = '#2e7d32';
      } else if (len > 32) {
        apiKeyHint.style.color = '#c62828';
        apiKeyHint.textContent = `è¾“å…¥çš„å­—ç¬¦æ•°: ${len}/32 (è¶…å‡ºé™åˆ¶)`;
      } else {
        apiKeyHint.style.color = '#86868b';
      }
    });

    // æ˜¾ç¤ºç»“æœ
    function showResult(type, message) {
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;
    }

    // æµ‹è¯• API Key
    async function testApiKey() {
      const apiKey = apiKeyInput.value.trim();
      
      if (!apiKey) {
        showResult('error', 'è¯·è¾“å…¥ API Key');
        return;
      }
      
      if (apiKey.length !== 32) {
        showResult('error', `API Key å¿…é¡»æ˜¯ 32 ä½å­—ç¬¦ï¼Œå½“å‰æ˜¯ ${apiKey.length} ä½`);
        return;
      }

      testBtn.disabled = true;
      testBtn.textContent = 'æµ‹è¯•ä¸­...';
      showResult('info', 'æ­£åœ¨æµ‹è¯• API Key...');

      try {
        // ä½¿ç”¨æ–‡æ¡£ä¸­çš„å®é™…æ¥å£è¿›è¡Œæµ‹è¯•
        const response = await fetch('https://www.runninghub.cn/openapi/v2/rhart-video-s/text-to-video', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            duration: '10',
            prompt: 'é˜³å…‰é€è¿‡é«˜å¤§çš„æ©¡æ ‘æ´’åœ¨ä¸€ç‰‡é­”æ³•æ£®æ—ä¸­ï¼Œå°ç‹ç‹¸ä¸ä¼šè¯´è¯çš„è˜‘è‡ä¸€èµ·è·³èˆã€‚ç”»é¢æŸ”å’Œæ¸©æš–ï¼Œæ‰‹ç»˜åŠ¨ç”»è´¨æ„Ÿï¼Œè‰²å½©æ˜äº®é¥±å’Œã€‚',
            aspectRatio: '9:16',
            storyboard: false
          })
        });

        const data = await response.json();

        if (response.ok) {
          if (data.taskId) {
            showResult('success', `âœ… API Key æœ‰æ•ˆï¼\n\nä»»åŠ¡ID: ${data.taskId}\nçŠ¶æ€: ${data.status}\n\næ‚¨çš„ API Key å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚`);
            
            // å–æ¶ˆæµ‹è¯•ä»»åŠ¡
            setTimeout(() => {
              console.log('æµ‹è¯•ä»»åŠ¡å·²åˆ›å»ºï¼ŒTaskID:', data.taskId);
            }, 1000);
          } else {
            showResult('error', `å“åº”å¼‚å¸¸: ${JSON.stringify(data, null, 2)}`);
          }
        } else {
          if (data.errorCode === '1007') {
            showResult('success', `âœ… API Key æœ‰æ•ˆï¼\n\nè™½ç„¶æç¤ºè¯å¤ªçŸ­å¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼Œä½†è¯´æ˜ API Key è®¤è¯é€šè¿‡äº†ã€‚\n\né”™è¯¯æç¤ºï¼š${data.errorMessage}\n\næ‚¨çš„ API Key å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè¯·åœ¨ä¸»åº”ç”¨ä¸­ä½¿ç”¨æ›´é•¿çš„æç¤ºè¯ï¼ˆè‡³å°‘5ä¸ªå­—ç¬¦ï¼‰ã€‚`);
          } else {
            showResult('error', `API Key æ— æ•ˆæˆ–ä»»åŠ¡å¤±è´¥\n\nçŠ¶æ€ç : ${response.status}\né”™è¯¯ç : ${data.errorCode}\né”™è¯¯ä¿¡æ¯: ${data.errorMessage}\n\nå®Œæ•´å“åº”ï¼š${JSON.stringify(data, null, 2)}`);
          }
        }

      } catch (error) {
        console.error('æµ‹è¯•å¤±è´¥:', error);
        
        if (error.message.includes('Failed to fetch')) {
          showResult('error', `ç½‘ç»œé”™è¯¯\n\n${error.message}\n\nå¯èƒ½åŸå› ï¼š\n1. ç½‘ç»œè¿æ¥é—®é¢˜\n2. CORS è·¨åŸŸé™åˆ¶ï¼ˆæµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼‰\n3. API æœåŠ¡å™¨æ— æ³•è®¿é—®\n\nè§£å†³æ–¹æ¡ˆï¼š\n- æ£€æŸ¥ç½‘ç»œè¿æ¥\n- ä½¿ç”¨ Vercel/CloudBase ç­‰å¹³å°éƒ¨ç½²ï¼ˆåç«¯è¯·æ±‚æ—  CORSï¼‰`);
        } else {
          showResult('error', `æµ‹è¯•å¤±è´¥: ${error.message}`);
        }
      }

      testBtn.disabled = false;
      testBtn.textContent = 'æµ‹è¯• API Key';
    }

    // è‡ªåŠ¨å¡«å…… localStorage ä¸­çš„ API Key
    window.onload = () => {
      const savedKey = localStorage.getItem('runninghub_api_key');
      if (savedKey) {
        apiKeyInput.value = savedKey;
        apiKeyHint.textContent = `è¾“å…¥çš„å­—ç¬¦æ•°: ${savedKey.length}/32`;
        if (savedKey.length === 32) {
          apiKeyHint.style.color = '#2e7d32';
        }
      }
    };

    // ä¿å­˜ API Key åˆ° localStorage
    function saveApiKey() {
      const key = apiKeyInput.value.trim();
      if (key.length === 32) {
        localStorage.setItem('runninghub_api_key', key);
        showResult('success', 'API Key å·²ä¿å­˜');
      }
    }

    // æ·»åŠ ä¿å­˜æŒ‰é’®
    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'ä¿å­˜ API Key';
    saveBtn.style.marginLeft = '0.5rem';
    saveBtn.onclick = saveApiKey;
    testBtn.parentNode.appendChild(saveBtn);
  </script>
</body>
</html>
